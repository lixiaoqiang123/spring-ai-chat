# å¿«é€Ÿå¼€å§‹ - Spring AI Chat æµå¼å“åº”

## 5åˆ†é’Ÿå¿«é€Ÿä½“éªŒ

### 1. é…ç½®ç¯å¢ƒå˜é‡ (30ç§’)

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®ä½ çš„æ™ºè°±AI APIå¯†é’¥
# ZHIPUAI_API_KEY=your_actual_api_key_here
```

æˆ–è€…ç›´æ¥è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼š
```bash
# Windows
set ZHIPUAI_API_KEY=your_actual_api_key_here

# Linux/Mac
export ZHIPUAI_API_KEY=your_actual_api_key_here
```

### 2. å¯åŠ¨åº”ç”¨ (30ç§’)

```bash
# å…‹éš†é¡¹ç›®(å¦‚æœè¿˜æ²¡æœ‰)
cd E:\AI\spring-api-chat

# å¯åŠ¨åº”ç”¨
mvn spring-boot:run
```

ç­‰å¾…çœ‹åˆ°ç±»ä¼¼è¾“å‡º:
```
Started SpringApiChatApplication in 3.456 seconds
```

### 3. æµè§ˆå™¨æµ‹è¯• (1åˆ†é’Ÿ)

æ‰“å¼€æµè§ˆå™¨è®¿é—®:
```
http://localhost:8080/stream-test.html
```

åœ¨è¾“å…¥æ¡†è¾“å…¥: `ä»‹ç»ä¸€ä¸‹Spring AI`

ç‚¹å‡»"å‘é€",è§‚å¯ŸAIå›å¤é€å­—å‡ºç°çš„æ•ˆæœ!

### 4. å‘½ä»¤è¡Œæµ‹è¯• (2åˆ†é’Ÿ)

#### Windowsç”¨æˆ·
```cmd
test-stream-api.bat
```

#### Linux/Macç”¨æˆ·
```bash
./test-stream-api.sh
```

### 5. ç¼–ç¨‹é›†æˆ (1åˆ†é’Ÿ)

#### cURLæµ‹è¯•
```bash
# æµå¼å“åº”
curl -N -X POST http://localhost:8080/api/chat/stream \
  -H "Content-Type: application/json" \
  -d '{"message":"ä½ å¥½","sessionId":null}'

# éæµå¼å“åº”
curl -X POST http://localhost:8080/api/chat/send \
  -H "Content-Type: application/json" \
  -d '{"message":"ä½ å¥½","sessionId":null}'
```

#### JavaScripté›†æˆ
```javascript
async function chat(message) {
    const response = await fetch('http://localhost:8080/api/chat/stream', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({message, sessionId: null})
    });

    const reader = response.body.getReader();
    const decoder = new TextDecoder();

    while (true) {
        const {value, done} = await reader.read();
        if (done) break;
        console.log(decoder.decode(value));
    }
}

chat("ä»‹ç»ä¸€ä¸‹Spring AI");
```

#### Javaé›†æˆ
```java
import org.springframework.web.reactive.function.client.WebClient;

WebClient client = WebClient.create("http://localhost:8080");

client.post()
    .uri("/api/chat/stream")
    .bodyValue(new ChatRequest("ä½ å¥½", null))
    .retrieve()
    .bodyToFlux(String.class)
    .subscribe(System.out::print);
```

## å®Œæ•´APIç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | ç±»å‹ | ç”¨é€” |
|------|------|------|------|
| `/api/chat/send` | POST | éæµå¼ | å®Œæ•´å“åº”,é€‚åˆAPIè°ƒç”¨ |
| `/api/chat/ask` | GET | éæµå¼ | ç®€ï¿½ï¿½ï¿½æ¥å£,å¿«é€Ÿæµ‹è¯• |
| `/api/chat/stream` | POST | æµå¼ | å®æ—¶æµå¼å“åº”,æ¨èUIä½¿ç”¨ |
| `/api/chat/stream` | GET | æµå¼ | ç®€åŒ–æµå¼æ¥å£,å¿«é€Ÿæµ‹è¯• |
| `/api/chat/health` | GET | å¥åº·æ£€æŸ¥ | æœåŠ¡çŠ¶æ€ |

## ç¤ºä¾‹å¯¹æ¯”

### éæµå¼ (ä¼ ç»Ÿæ–¹å¼)
```bash
curl -X POST http://localhost:8080/api/chat/send \
  -H "Content-Type: application/json" \
  -d '{"message":"ä»‹ç»Spring AI","sessionId":null}'
```

**è¾“å‡º** (ä¸€æ¬¡æ€§è¿”å›):
```json
{
  "reply": "Spring AIæ˜¯ä¸€ä¸ª...(å®Œæ•´å†…å®¹)",
  "sessionId": "uuid",
  "timestamp": 1701234567890
}
```

### æµå¼ (æ–°æ–¹å¼)
```bash
curl -N -X POST http://localhost:8080/api/chat/stream \
  -H "Content-Type: application/json" \
  -d '{"message":"ä»‹ç»Spring AI","sessionId":null}'
```

**è¾“å‡º** (é€å­—è¿”å›):
```
event: message
data: Spring

event: message
data:  AI

event: message
data:  æ˜¯

event: message
data: ä¸€ä¸ª...

event: done
data: {"sessionId":"uuid"}
```

## å…³é”®åŒºåˆ«

| ç‰¹æ€§ | éæµå¼ | æµå¼ |
|------|--------|------|
| å“åº”æ—¶é—´ | éœ€ç­‰å¾…å®Œæ•´ç”Ÿæˆ | ç«‹å³å¼€å§‹è¿”å› |
| ç”¨æˆ·ä½“éªŒ | ç­‰å¾…æ„Ÿå¼º | å®æ—¶åé¦ˆ |
| é€‚ç”¨åœºæ™¯ | APIå¯¹æ¥ã€çŸ­æ–‡æœ¬ | ç”¨æˆ·ç•Œé¢ã€é•¿æ–‡æœ¬ |
| å†…å­˜å ç”¨ | éœ€ç¼“å­˜å®Œæ•´å“åº” | è¾¹ç”Ÿæˆè¾¹å‘é€ |
| è¶…æ—¶é£é™© | é•¿æ–‡æœ¬å¯èƒ½è¶…æ—¶ | æµå¼ä¼ è¾“,é£é™©ä½ |

## æ ¸å¿ƒä»£ç 

### Serviceå±‚
```java
// ChatService.java
public Flux<String> chatStream(ChatRequest request) {
    return chatClient.prompt()
            .user(request.getMessage())
            .stream()      // Spring AIçš„stream()æ–¹æ³•
            .content();    // æå–å†…å®¹æµ
}
```

### Controllerå±‚
```java
// ChatController.java
@PostMapping(value = "/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
public Flux<ServerSentEvent<String>> streamMessage(@RequestBody ChatRequest request) {
    return chatService.chatStream(request)
            .map(content -> ServerSentEvent.<String>builder()
                    .event("message")
                    .data(content)
                    .build());
}
```

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•åˆ‡æ¢å›éæµå¼?
A: ä½¿ç”¨ `/api/chat/send` ç«¯ç‚¹å³å¯,ä¸¤ç§æ–¹å¼å¹¶å­˜ã€‚

### Q: å‰ç«¯å¦‚ä½•å¤„ç†æµå¼å“åº”?
A: å‚è€ƒ `stream-test.html` ä¸­çš„å®Œæ•´ç¤ºä¾‹ã€‚

### Q: æ”¯æŒå“ªäº›ç¼–ç¨‹è¯­è¨€?
A: ä»»ä½•æ”¯æŒHTTPçš„è¯­è¨€éƒ½å¯ä»¥,æä¾›äº†Javaã€JavaScriptã€Pythonç¤ºä¾‹ã€‚

### Q: å¦‚ä½•ç»´æŒå¯¹è¯ä¸Šä¸‹æ–‡?
A: ä¿å­˜è¿”å›çš„ `sessionId`,åœ¨åç»­è¯·æ±‚ä¸­ä¼ å…¥ã€‚

### Q: æ€§èƒ½å¦‚ä½•?
A: ä½¿ç”¨å“åº”å¼ç¼–ç¨‹å’ŒVirtual Threads,æ”¯æŒé«˜å¹¶å‘åœºæ™¯ã€‚

## ä¸‹ä¸€æ­¥

1. **æŸ¥çœ‹å®Œæ•´æ–‡æ¡£**: `STREAMING_API_GUIDE.md`
2. **è¿è¡Œæµ‹è¯•è„šæœ¬**: `test-stream-api.bat` æˆ– `test-stream-api.sh`
3. **æŸ¥çœ‹Javaç¤ºä¾‹**: `StreamChatClientExample.java`
4. **é˜…è¯»å®ç°æ€»ç»“**: `STREAM_IMPLEMENTATION_SUMMARY.md`

## æŠ€æœ¯æ”¯æŒ

- **é¡¹ç›®æ–‡æ¡£**: æŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•çš„æ‰€æœ‰ `.md` æ–‡ä»¶
- **æµ‹è¯•é¡µé¢**: `http://localhost:8080/stream-test.html`
- **å¥åº·æ£€æŸ¥**: `http://localhost:8080/api/chat/health`

---

**æç¤º**: å¦‚æœé‡åˆ°é—®é¢˜,è¯·å…ˆæ£€æŸ¥:
1. ç¯å¢ƒå˜é‡ `ZHIPUAI_API_KEY` æ˜¯å¦æ­£ç¡®è®¾ç½®
2. åº”ç”¨æ˜¯å¦æ­£å¸¸å¯åŠ¨
3. ç«¯å£8080æ˜¯å¦è¢«å ç”¨

**å¼€å§‹äº«å—æµå¼å¯¹è¯ä½“éªŒå§!** ğŸš€
